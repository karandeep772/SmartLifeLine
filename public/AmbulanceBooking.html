<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Patient Emergency Form</title>
  <link rel="stylesheet" href="CSS/AmbulanceBooking.css">

  <script>
    // ðŸ“ Get Live Location
    async function getLocation() {
      const locationInput = document.getElementById("location");
      const latInput = document.getElementById("latitude");
      const lonInput = document.getElementById("longitude");

      locationInput.placeholder = "Fetching location...";

      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          async (position) => {
            const lat = position.coords.latitude.toFixed(4);
            const lon = position.coords.longitude.toFixed(4);

            latInput.value = lat;
            lonInput.value = lon;

            try {
              const res = await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json`);
              const data = await res.json();
              locationInput.value = data.display_name || `Lat: ${lat}, Long: ${lon}`;
            } catch {
              locationInput.value = `Lat: ${lat}, Long: ${lon}`;
            }
            locationInput.placeholder = "";
          },
          (error) => {
            locationInput.placeholder = "Unable to fetch location!";
            alert("Please allow location permission.");
          }
        );
      } else {
        alert("Geolocation not supported by your browser.");
      }
    }

    // ðŸ”¢ Emergency level update
    function updateLevel(value) {
      document.getElementById("levelValue").innerText = value;
    }

    // âœ… Input validation
    function validateInput() {
      const name = document.getElementById("name");
      const contact = document.getElementById("contact");
      if (name.value.length < 3) name.setCustomValidity("Enter full name (min 3 chars)");
      else name.setCustomValidity("");
      if (!/^[0-9]{10}$/.test(contact.value)) contact.setCustomValidity("Enter valid 10-digit number");
      else contact.setCustomValidity("");
    }
  </script>
</head>

<body>
  <div class="container">
    <h2>Ambulance Booking Form</h2>
    <form action="/submit" method="POST" oninput="validateInput()">
      
      <div class="form-group">
        <label>Patient Name</label>
        <input type="text" id="name" name="name" placeholder="Enter full name" required>
      </div>

      <div class="form-group">
        <label>Age</label>
        <input type="number" id="age" name="age" min="1" max="120" placeholder="Enter age of patient" required>
      </div>

      <div class="form-group">
        <label>Blood Group</label>
        <select name="blood_group" required>
          <option value="">-- Select Blood Group --</option>
          <option>A+</option><option>A-</option>
          <option>B+</option><option>B-</option>
          <option>O+</option><option>O-</option>
          <option>AB+</option><option>AB-</option>
        </select>
      </div>

      <div class="form-group">
        <label>Emergency Contact No.</label>
        <input type="tel" id="contact" name="emergency_contact" placeholder="Enter 10-digit number" required>
      </div>

      <div class="form-group">
        <label>Location</label>
        <div class="location-box">
          <input type="text" id="location" name="location" placeholder="Click button to fetch live location" readonly required>
          <input type="hidden" id="latitude" name="latitude">
          <input type="hidden" id="longitude" name="longitude">
          <button type="button" onclick="getLocation()">Current Location</button>
        </div>
      </div>

      <div class="form-group">
        <label>Address</label>
        <input type="text" id="address" name="address" placeholder="Enter address">
      </div>

      <div class="form-group">
        <label>Emergency Level (1 to 10)</label>
        <input type="range" id="level" name="emergency_level" min="1" max="10" value="5" oninput="updateLevel(this.value)">
        <span id="levelValue">5</span>
      </div>

      <div class="form-group">
        <label>Symptoms</label>
        <textarea name="symptoms" rows="3" placeholder="Describe symptoms clearly..." required></textarea>
      </div>

      <button type="submit">Submit Form</button>
    </form>
  </div>
</body>
</html>